<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="stylesheet" href="style.css">
    <script type="module" src="firebase.js" defer></script> <!-- Include the firebase.js script -->
</head>
<body>

    <div class="co-checkout-container">
        <!-- Breadcrumb -->
        <p class="co-breadcrumb">Home / Your Bag</p>

        <!-- Bag Details -->
        <h2>Checkout (<span id="checkoutItemCount">0</span> items)</h2>

        <div id="checkoutItemsContainer">
            <p class="empty-cart-message">Your bag is empty</p>
        </div>

        <hr>

        <!-- Order Summary -->
        <div class="co-summary">
            <p><strong>Subtotal:</strong> <span id="subtotalPrice">$0.00</span></p>
            
            <p><strong>Promotional Code:</strong> <span class="co-cancel-code">Cancel</span></p>
            <div class="promo-container">
                <input type="text" id="promoInput" class="co-promo-input" placeholder="Enter your promotional code">
                <button id="applyPromo" class="co-apply-btn">Apply</button>
            </div>

            <p><strong>Grand Total:</strong> <span id="grandTotal">$0.00</span></p>
        </div>

        <!-- Payment Methods -->
        <div class="co-payment-methods">
            <img src="figmaPics/PayPal.png" alt="PayPal">
            <img src="figmaPics/Mastercard.png" alt="MasterCard">
            <img src="figmaPics/GooglePay.png" alt="Google Pay">
        </div>

        <!-- Checkout Button -->
        <button id="checkoutSubmit" class="co-checkout-btn">CHECK OUT</button>
    </div>

    <script>
        // Function to load checkout items from local storage
        function loadCheckoutItems() {
            const checkoutContents = document.getElementById('checkoutItemsContainer');
            const checkoutItemCount = document.getElementById('checkoutItemCount');
            const subtotalPrice = document.getElementById('subtotalPrice');
            const grandTotal = document.getElementById('grandTotal');
            const promoInput = document.getElementById('promoInput');
            const applyPromoButton = document.getElementById('applyPromo');
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            checkoutContents.innerHTML = '';

            if (cart.length === 0) {
                checkoutContents.innerHTML = '<p class="empty-cart-message">Your bag is empty</p>';
                subtotalPrice.textContent = '$0.00';
                grandTotal.textContent = '$0.00';
            } else {
                let subtotal = 0;
                cart.forEach((product) => {
                    let price = parseFloat(product.price) || 0;
                    let totalItemPrice = price * product.quantity;
                    subtotal += totalItemPrice;

                    const productDiv = document.createElement('div');
                    productDiv.className = 'co-product';
                    productDiv.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.title}" class="co-product-img">
                        <div class="co-product-details">
                            <p><strong>${product.title}</strong></p>
                            <p>Price: <span class="price">$${price.toFixed(2)}</span></p>
                            <p>Quantity: ${product.quantity}</p>
                            <p>Total: <strong>$${totalItemPrice.toFixed(2)}</strong></p>
                        </div>
                    `;
                    checkoutContents.appendChild(productDiv);
                });

                checkoutItemCount.textContent = cart.reduce((total, item) => total + item.quantity, 0);
                subtotalPrice.textContent = `$${subtotal.toFixed(2)}`;
                grandTotal.textContent = `$${subtotal.toFixed(2)}`;
            }

            // Applying promotional code
            applyPromoButton.addEventListener('click', () => {
                let promoCode = promoInput.value.trim();
                if (promoCode === 'DISCOUNT10') {
                    let discount = 0.1; // 10% discount
                    let discountedTotal = subtotal * (1 - discount);
                    grandTotal.textContent = `$${discountedTotal.toFixed(2)}`;
                    alert("Promo code applied!");
                } else {
                    alert("Invalid promo code.");
                }
            });
        }

        // Function to handle checkout process
        function handleCheckout(event) {
            event.preventDefault();

            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const address = document.getElementById('address').value;
            const email = document.getElementById('email').value;

            // Here you can proceed with the checkout process
            console.log("Checkout Information:", {
                firstName,
                lastName,
                address,
                email
            });

            // Simulate submitting the order (e.g., saving to Firestore, processing payment)
            alert("Order submitted successfully!");
            window.location.href = "orderConfirmation.html";  // Redirect to order confirmation page
        }

        // Initialize the checkout page on load
        window.onload = loadCheckoutItems;

        // Attach event listener to checkout submit button
        const checkoutSubmit = document.getElementById('checkoutSubmit');
        if (checkoutSubmit) {
            checkoutSubmit.addEventListener("click", handleCheckout);
        }
    </script>

</body>
</html>
